# Отладка проблем с извлечением ордеров на Bybit

## Проблема
Расширение показывает "Ордера не найдены на странице" или "Найдено X потенциальных элементов", но не может извлечь данные ордеров.

## Решение: Пошаговая отладка

### Шаг 1: Обновите расширение до версии 1.2
1. Откройте `chrome://extensions/`
2. Найдите "Bybit Order Tracker"
3. Нажмите "Обновить" или переустановите расширение

### Шаг 2: Запустите отладочный скрипт
1. Откройте страницу Bybit с историей ордеров
2. Нажмите F12 для открытия консоли браузера
3. Скопируйте и вставьте содержимое файла `bybit-extension/debug.js` в консоль
4. Нажмите Enter

### Шаг 3: Анализируйте результаты отладки

#### Что показывает отладочный скрипт:

1. **Элементы с валютами** - находит все элементы содержащие RUB, USDT, BTC
2. **Элементы с ключевыми словами** - находит элементы с "продажа", "покупка", "buy", "sell"
3. **Строки таблиц** - показывает найденные строки таблиц
4. **Тестирование извлечения данных** - проверяет, можно ли извлечь данные ордеров
5. **Специфичные элементы Bybit** - ищет элементы с различными селекторами

#### Примеры результатов:

**✅ Успешный результат:**
```
Найдено 15 элементов с валютами
Найдено 8 элементов с ключевыми словами
Найдено 12 строк таблиц
Тест 1: {orderId: "USDT_sell_1234567890", symbol: "USDT/USDT", side: "sell", hasMinimalData: true}
```

**⚠️ Проблемный результат:**
```
Найдено 25 элементов с валютами
Найдено 12 элементов с ключевыми словами
Найдено 0 строк таблиц
Тест 1: {orderId: "", symbol: "", side: "", hasMinimalData: false}
```

### Шаг 4: Исправление проблем

#### Проблема 1: Найдены элементы, но не извлекаются данные

**Причина:** Структура данных на странице отличается от ожидаемой.

**Решение:**
1. Найдите в результатах отладки элементы с вашими ордерами
2. Посмотрите на структуру текста
3. Скопируйте пример текста элемента с ордером

**Пример:** Если видите элемент:
```
1. DIV.order-item: Продажа USDT 191.2886982052605952 83.75 RUB 11,473.75 RUB завершен
```

Значит данные есть, но нужно улучшить регулярные выражения.

#### Проблема 2: Не найдены строки таблиц

**Причина:** Bybit использует нестандартную структуру таблиц.

**Решение:**
1. В консоли выполните:
```javascript
// Найти все элементы с ордерами
document.querySelectorAll('*').forEach(el => {
  if (el.textContent.includes('Продажа') && el.textContent.includes('USDT')) {
    console.log('Найден ордер:', el.tagName, el.className, el.textContent);
  }
});
```

2. Определите правильный селектор для ваших ордеров

#### Проблема 3: Данные в неожиданном формате

**Причина:** Bybit изменил формат отображения данных.

**Решение:**
1. Посмотрите на конкретный текст элемента с ордером
2. Определите, где находятся:
   - Тип операции (продажа/покупка)
   - Валюта (USDT, RUB, BTC)
   - Количество
   - Цена
   - Статус

### Шаг 5: Создание кастомного селектора

Если стандартные селекторы не работают, создайте свой:

1. **Найдите родительский элемент** всех ордеров:
```javascript
// В консоли браузера
const orderContainer = document.querySelector('селектор_контейнера');
console.log('Контейнер ордеров:', orderContainer);
```

2. **Найдите все дочерние элементы** с ордерами:
```javascript
const orderElements = orderContainer.querySelectorAll('селектор_ордера');
console.log('Найдено ордеров:', orderElements.length);
```

3. **Добавьте новый селектор** в расширение:
   - Откройте `bybit-extension/content.js`
   - Найдите массив `orderSelectors`
   - Добавьте ваш селектор в начало массива

### Шаг 6: Тестирование кастомного извлечения

Если нужно изменить логику извлечения данных:

```javascript
// Тестируйте в консоли
function testCustomExtraction(element) {
  const text = element.textContent;
  console.log('Тестируем элемент:', text);
  
  // Ваша логика извлечения данных
  const isOrder = text.includes('Продажа') || text.includes('Покупка');
  const currency = text.match(/([A-Z]{3,})/g);
  const numbers = text.match(/[\d,]+\.?\d*/g);
  
  console.log('Результат:', {isOrder, currency, numbers});
}

// Тестируйте на найденных элементах
document.querySelectorAll('*').forEach(el => {
  if (el.textContent.includes('USDT') && el.textContent.includes('Продажа')) {
    testCustomExtraction(el);
  }
});
```

## Часто встречающиеся проблемы

### 1. Динамическая загрузка контента
**Проблема:** Ордера загружаются после загрузки страницы.
**Решение:** Подождите несколько секунд после загрузки страницы, затем запустите расширение.

### 2. Изменение языка интерфейса
**Проблема:** Расширение настроено на русский язык, а интерфейс на английском.
**Решение:** Переключите интерфейс Bybit на русский язык или обновите расширение для поддержки английского.

### 3. Разные разделы Bybit
**Проблема:** Расширение работает в одном разделе, но не в другом.
**Решение:** Протестируйте в разных разделах:
- История ордеров
- Активные ордера
- История сделок
- P2P ордера

## Отправка отчета об ошибке

Если проблема не решается:

1. **Соберите информацию:**
   - Результаты отладочного скрипта
   - URL страницы Bybit
   - Скриншот страницы с ордерами
   - Версия браузера

2. **Экспортируйте HTML страницы:**
```javascript
// В консоли браузера
console.log(document.documentElement.outerHTML);
```

3. **Опишите проблему:**
   - Что ожидали увидеть
   - Что получили на самом деле
   - Шаги для воспроизведения

Эта информация поможет быстро исправить проблему и добавить поддержку для вашего конкретного случая. 